% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prevalence-POP_plots.R
\name{ph_volcano}
\alias{ph_volcano}
\title{Volcano plots (log2 ratio vs -log10 p) from ph_prevalence_compare()}
\usage{
ph_volcano(
  comparison_tbl,
  ranks = NULL,
  pair = NULL,
  universe = NULL,
  features = NULL,
  features_regex = FALSE,
  universe_regex = FALSE,
  color_by = NULL,
  color_title = NULL,
  facet_pairs = TRUE,
  facet_nrow = NULL,
  facet_ncol = NULL,
  sparse_rank = NULL,
  sparse_drop_pct = 0,
  sparse_seed = NULL,
  fc_cut = 1,
  p_cut = 0.05,
  p_mode = c("raw", "bh", "wbh"),
  significant_colors = c(`not significant` = "#386cb0", `significant prior correction` =
    "#1b9e77", `significant post fdr correction` = "#e31a1c"),
  interactive = TRUE
)

ph_volcano(
  comparison_tbl,
  ranks = NULL,
  pair = NULL,
  universe = NULL,
  features = NULL,
  features_regex = FALSE,
  universe_regex = FALSE,
  color_by = NULL,
  color_title = NULL,
  facet_pairs = TRUE,
  facet_nrow = NULL,
  facet_ncol = NULL,
  sparse_rank = NULL,
  sparse_drop_pct = 0,
  sparse_seed = NULL,
  fc_cut = 1,
  p_cut = 0.05,
  p_mode = c("raw", "bh", "wbh"),
  significant_colors = c(`not significant` = "#386cb0", `significant prior correction` =
    "#1b9e77", `significant post fdr correction` = "#e31a1c"),
  interactive = TRUE
)
}
\arguments{
\item{comparison_tbl}{\code{ph_prev_result} or \code{data.frame} with columns:
\code{rank}, \code{feature}, \code{group_col}, \code{group1}, \code{group2},
\code{prop1}, \code{prop2}, optional \code{ratio},
\code{p_raw}, \code{p_adj_rank}, \code{p_adj_rank_wbh},
and optionally \code{category_rank_wbh}.}

\item{ranks}{character vector of ranks to plot (default: all present)}

\item{pair}{optional length-2 character, e.g. \code{c("kid_serum::T2","kid_serum::T8")}}

\item{universe}{optional \code{group_col} value(s) or regex (with \code{universe_regex=TRUE})}

\item{features}{optional character vector or regex patterns (with \code{features_regex=TRUE})}

\item{features_regex}{logical; treat \code{features} as regex (OR over patterns)}

\item{universe_regex}{logical; treat \code{universe} as regex (OR over patterns)}

\item{color_by}{optional peptide-library column to color by (e.g. \code{"is_flagellum"})}

\item{color_title}{optional legend title when \code{color_by} is used}

\item{facet_pairs}{logical; if \code{TRUE} (default) facet/subplot all pairs per rank}

\item{facet_nrow, facet_ncol}{integers controlling subplot grid (interactive only)}

\item{sparse_rank}{character(1) rank within which to downsample "not significant"}

\item{sparse_drop_pct}{numeric in \link{0,1}; fraction to drop within \code{sparse_rank}}

\item{sparse_seed}{integer or \code{NULL}; set for reproducible downsampling}

\item{fc_cut}{numeric; vertical cutoff for \verb{|log2(ratio)|} (default 1)}

\item{p_cut}{numeric; cutoff for p/q (default 0.05)}

\item{p_mode}{one of \code{c("raw","bh","wbh")} (default \code{"raw"})}

\item{significant_colors}{named vector used for default category colors}

\item{interactive}{\code{TRUE} (default) uses plotly; \code{FALSE} returns ggplot}
}
\value{
A named list of plots. If facet_pairs=TRUE: one plot per rank.
If facet_pairs=FALSE: for each rank a sub-list of plots per (group1 vs group2).

named list of plots:
\itemize{
\item if \code{facet_pairs=TRUE}: one plot per rank
\item if \code{facet_pairs=FALSE}: per rank a sub-list of \verb{(group1 vs group2)} plots
}
}
\description{
Build volcano plot(s) of log2(ratio) vs -log10(p) from results produced by
\code{ph_prevalence_compare()}. Accepts a \code{ph_prev_result} (recommended) or a
plain \code{data.frame} with the standard columns. Supports convenient subsetting
by pair, rank, universe (\code{group_col}) and features. By default, colors show
significance category; alternatively you can color by any peptide-level
attribute available in the \strong{saved peptide library} attached in
\code{attr(x, "prev_meta")$peptide_library}.
}
\details{
\strong{Which p-value is on the Y axis}
\itemize{
\item \code{p_mode = "raw"}  uses \code{p_raw}
\item \code{p_mode = "bh"}   uses \code{p_adj_rank}
\item \code{p_mode = "wbh"}  uses \code{p_adj_rank_wbh}
}

\strong{Categories (default coloring)}
If \code{category_rank_wbh} exists, it's used. Otherwise categories are derived:
\itemize{
\item "significant post fdr correction": chosen p (\code{p_mode}) ≤ \code{p_cut} \strong{and} |log2ratio| ≥ \code{fc_cut}
\item "significant prior correction"   : raw p ≤ \code{p_cut} \strong{and} |log2ratio| ≥ \code{fc_cut} but adjusted > \code{p_cut}
\item "not significant"                : otherwise
}

\strong{Coloring by peptide metadata}
Set \code{color_by = "<column>"} to color points by a column from the saved
peptide library (e.g. \code{is_flagellum}, \code{kingdom}, \code{domain}, ...). No download
is attempted; the function uses the handle stored in \code{prev_meta}.

\strong{Output}
\itemize{
\item If \code{facet_pairs = TRUE}: one plot per rank (as a named list). For
interactive plots, pairs are tiled using \code{plotly::subplot}.
\item If \code{facet_pairs = FALSE}: per rank, a named sub-list with one plot per
\verb{(group1 vs group2)}.
}
}
\examples{
# p <- ph_volcano(
#   scatters,
#   ranks = "peptide_id",
#   pair  = c("kid_serum::T2","kid_serum::T8"),
#   p_mode = "wbh", fc_cut = 1, p_cut = 0.05,
#   color_by = "is_flagellum", color_title = "Flagellum"
# )
# p[["peptide_id"]]
}
