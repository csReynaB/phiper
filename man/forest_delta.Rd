% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prevalence-DELTA_plots.R
\name{forest_delta}
\alias{forest_delta}
\title{Forest plot of top/bottom raw Stouffer T by rank (with arrows)}
\usage{
forest_delta(
  x,
  rank_of_interest,
  n_each = 15,
  color = FALSE,
  bh_only = TRUE,
  add_signed_z_from_p = FALSE,
  left_label = "More in group1",
  right_label = "More in group2",
  arrow_frac = 0.35,
  text_size = 3.8,
  text_gap_frac = 0.06,
  y_pad = 0.6,
  text_y_offset = 0,
  text_vjust = -0.3,
  arrow_color = "red",
  arrow_lwd = 0.6,
  arrow_head_cm = 0.3
)
}
\arguments{
\item{x}{A data frame/tibble with at least:
\verb{rank, feature, group1, group2, design, T_obs, p_perm, p_adj_rank, category_rank_bh}.}

\item{rank_of_interest}{Character scalar, e.g. \code{"species"}.}

\item{n_each}{Integer; how many items from negative and positive tails (default 15).}

\item{color}{Logical; if \code{TRUE}, lines/points are shaded blue (left, T<0) to
red (right, T>0) with higher contrast; otherwise monochrome.}

\item{bh_only}{Logical; if \code{TRUE} (default) keep only rows with
\code{category_rank_bh == "significant (BH, per rank)"}.}

\item{add_signed_z_from_p}{Logical; if \code{TRUE}, computes a signed Z from
permutation p (\code{sign(T_obs) * qnorm(1 - p_perm/2)}) and returns it in data.}

\item{left_label}{Text for the left arrow/side label.}

\item{right_label}{Text for the right arrow/side label.}

\item{arrow_frac}{Fraction of max |T_obs| used as half-length of arrows.}

\item{text_size}{Arrow-end label size (ggplot2 size units).}

\item{text_gap_frac}{Horizontal gap for arrow labels beyond arrow tips (fraction of max |T_obs|).}

\item{y_pad}{Vertical padding above the top category for arrows/labels (in y units).}

\item{text_y_offset}{Additional vertical offset for arrow-end labels (in y units).}

\item{text_vjust}{Passed to \code{annotate("text", vjust=...)} (default -0.30).}

\item{arrow_color}{Arrow/label color.}

\item{arrow_lwd}{Arrow line width.}

\item{arrow_head_cm}{Arrow head length in cm.}
}
\value{
A list with:
\itemize{
\item \code{data} – tibble used for plotting (selected top/bottom items),
\item \code{plot} – ggplot object.
}
}
\description{
Builds a forest plot for the most extreme DELTA/Stouffer results within a
chosen rank using the \strong{raw} \code{T_obs} (no division by any SD). Rows can be
restricted to BH-significant results (per rank). Colors are purely aesthetic
and do not change geometry.
}
\details{
\itemize{
\item \code{T_obs} here is plotted \strong{as is} (raw Stouffer statistic from your shift).
\item For calibrated inference or cross-figure comparability, prefer permutation
p-values (optionally expose \code{add_signed_z_from_p=TRUE} for reporting).
}
}
\examples{
\dontrun{
out <- forest_delta(res_shift, rank_of_interest = "species",
                    n_each = 15, color = TRUE)
out$plot
}

}
