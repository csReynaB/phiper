% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/binary-analysis_stability.R
\name{compute_repertoire_similarity}
\alias{compute_repertoire_similarity}
\title{Compute repertoire similarity with group/subject/time pairing controls}
\usage{
compute_repertoire_similarity(
  x,
  group_col,
  time_col,
  similarity = c("jaccard", "sorensen", "bray_curtis", "kulczynski", "phi", "pearson",
    "beta_sim"),
  mode = c("within", "between", "all"),
  dyade_col = NULL,
  time_mode = c("reference", "pairwise"),
  time_pairing = c("same", "cross"),
  ref_time = c("earliest", "latest"),
  subject_mode = c("self_or_dyad", "self", "all"),
  drop_self_time = TRUE,
  out_table = NULL,
  overwrite = FALSE,
  verbose = .ph_opt("verbose", TRUE)
)
}
\arguments{
\item{x}{A \verb{<phip_data>} object; \strong{must be longitudinal}.}

\item{group_col}{Character or NULL; grouping column in \code{x$data_long}.
If \code{NULL}, a synthetic group \code{"all"} is added.}

\item{time_col}{Character; time column in \code{x$data_long}. May be numeric,
Date/POSIX (continuous) or factor/character (categorical).}

\item{similarity}{One of: "jaccard","sorensen","bray_curtis","kulczynski",
"phi","pearson". ("pearson" is accepted and mapped to "phi".)}

\item{mode}{Group scope: one of "within","between","all".}

\item{dyade_col}{Optional character; column that encodes dyad/triad IDs.
Members of the same dyad/triad share the same ID.}

\item{time_mode}{One of: "reference","pairwise".
\itemize{
\item "reference": compare each subject/time to a within-subject baseline
(earliest or latest) \strong{within the same group}.
\item "pairwise" : only for \strong{categorical} time; build subject×subject pairs
for each (time) and the selected group scope.
}}

\item{ref_time}{If \code{time_mode=="reference"}, baseline selection:
one of "earliest","latest".}

\item{subject_mode}{One of: "self_or_dyad" (default), "self", "all".
\itemize{
\item "self"         : only pairs with identical \code{subject_id}.
\item "self_or_dyad" : identical subjects OR same \code{dyade_col} (if provided).
\item "all"          : all subject pairs consistent with \code{mode} and time alignment.
}}

\item{drop_self_time}{Logical; for "reference" mode, drop baseline self rows
(time == baseline). Default TRUE.}

\item{out_table}{Optional character; name for the materialized DuckDB table.
If NULL, a unique name is generated.}

\item{overwrite}{Logical; if TRUE and \code{out_table} exists, it will be replaced.}

\item{verbose}{Logical; phiper logging verbosity (default from \code{.ph_opt}).}
}
\value{
A lazy \code{tbl} pointing to the materialized DuckDB table on \code{x$meta$con}.
Attributes include \code{table_name}, \code{time_mode}, \code{similarity}, and \code{mode}.
}
\description{
Flexible engine for binary repertoire similarity that supports:
\itemize{
\item Group scope: within-group, between-group, or both (union).
\item Subject pairing: only self, self-or-dyad/triad, or all subjects.
\item Time behavior: reference to a baseline (earliest/latest) \strong{or} all pairwise
comparisons across categorical timepoints.
}

By default this reproduces the earlier "stability" behavior (baseline within
subject & group), but now also enables subject-by-subject matrices per
group×time for categorical designs (dyads/triads supported).

\strong{Similarities (binary):}
\itemize{
\item \code{"jaccard"}      : |A∩B| / |A∪B|
\item \code{"sorensen"}     : 2|A∩B| / (|A|+|B|)
\item \code{"bray_curtis"}  : identical to Sørensen in the binary case
\item \code{"kulczynski"}   : 0.5 * \link{ a/(a+b) + a/(a+c) } with a=|A∩B|
\item \code{"phi"} (≡ Pearson for binary)
}
}
