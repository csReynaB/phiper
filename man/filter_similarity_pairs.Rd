% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/binary-analysis_stability.R
\name{filter_similarity_pairs}
\alias{filter_similarity_pairs}
\title{Filter pairwise similarity rows by (group,time) pairs and dyad/paring rules}
\usage{
filter_similarity_pairs(
  stab,
  pairs,
  pairing = NULL,
  dyad_mode = c("any", "same", "different"),
  allow_swap = TRUE
)
}
\arguments{
\item{stab}{A dplyr table (data.frame, tibble, or lazy \code{tbl_dbi}) with
the standard pairwise columns:
\code{time_left}, \code{group_left}, \code{subject_left},
\code{time_right}, \code{group_right}, \code{subject_right},
\code{similarity}, \code{pairing}, and optionally \code{dyad_left}, \code{dyad_right}.}

\item{pairs}{A data.frame/tibble specifying the requested comparisons.
Must contain \strong{character} columns:
\code{group_left}, \code{time_left}, \code{group_right}, \code{time_right}.
You may pass multiple rows to select many comparisons at once.}

\item{pairing}{\code{NULL}, a single string, or a character vector limiting rows
by pairing type. Use \code{"same"}, \code{"cross"}, or \code{c("same","cross")}.
When \code{NULL} (default), no pairing filter is applied.}

\item{dyad_mode}{One of \code{c("any","same","different")}. If \code{"same"}, keep only
rows where \code{dyad_left == dyad_right} (and both non-NA). If \code{"different"},
keep only rows where \code{dyad_left != dyad_right} (and both non-NA).
\code{"any"} keeps all rows regardless of dyads. Defaults to \code{"any"}.}

\item{allow_swap}{Logical. If \code{TRUE} (default), comparisons in \code{pairs} are
matched in \strong{either} orientation (i.e., also accept rows where the requested
left/right are swapped in \code{stab}). If \code{FALSE}, only the exact leftâ†’right
orientation is matched.}
}
\value{
A filtered table of the \strong{same dplyr backend} as \code{stab}
(lazy when \code{stab} is DB-backed). Columns are unchanged from \code{stab}.
}
\description{
Efficiently subset a pairwise similarity table (e.g. output of
\code{compute_repertoire_similarity(..., time_mode = "pairwise")}) to selected
combinations of \verb{(group_left, time_left)} compared against
\verb{(group_right, time_right)}, optionally restricting the \code{pairing} type
(\code{"same"}, \code{"cross"}) and dyad relationship (\code{"any"}, \code{"same"}, \code{"different"}).
Designed to be DuckDB-/dbplyr-friendly (uses joins; no rowwise R loops).
}
\details{
Internally the function builds a small comparison key table from \code{pairs},
optionally adds the swapped orientation, and then performs a \code{semi_join}
against \code{stab} via temporary columns. This preserves the database backend
(e.g., DuckDB) and avoids pulling data into R.
}
\examples{
\dontrun{
# Keep mom_milk T4 vs mom_milk T6 (cross-time), any dyad, either orientation
pairs <- tibble::tribble(
  ~group_left, ~time_left, ~group_right, ~time_right,
  "mom_milk",  "T4",       "mom_milk",   "T6"
)

res <- filter_similarity_pairs(
  stab       = stab_df_kulczynski,
  pairs      = pairs,
  pairing    = "cross",
  dyad_mode  = "any",
  allow_swap = TRUE
)

# Same-dyad only:
res_same <- filter_similarity_pairs(stab_df_kulczynski, pairs,
  pairing = "cross", dyad_mode = "same")

# Multiple requested pairs:
pairs2 <- tibble::tribble(
  ~group_left, ~time_left, ~group_right, ~time_right,
  "mom_milk","T4","mom_milk","T6",
  "mom_milk","T3","mom_milk","T6"
)
res_multi <- filter_similarity_pairs(stab_df_kulczynski, pairs2,
  pairing = "cross", dyad_mode = "any")
}

}
\seealso{
\code{\link[=compute_repertoire_similarity]{compute_repertoire_similarity()}}, \code{plot_similarity_heatmap()}
}
